<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Results | GradSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        /* Transparent Heatmap Zones with Area Margins */
        .heatmap-zone { 
            border-bottom: 2px dashed rgba(0,0,0,0.15); 
            position: absolute; width: 100%; height: 33.33%; 
            display: flex; align-items: center; justify-content: center; 
            transition: all 0.5s ease;
            opacity: 0.4; /* RESTORED: Handwriting is now visible */
        }
        .heatmap-zone:last-child { border-bottom: none; }
        
        /* High-Visibility Black Text */
        .density-pill { 
            color: #000000; background: rgba(255,255,255,0.6); 
            padding: 6px 16px; border-radius: 99px; font-weight: 900; 
            font-size: 0.875rem; backdrop-filter: blur(8px); 
            opacity: 1 !important; /* Ensures text is solid while background is transparent */
        }
    </style>
</head>
<body class="bg-[#F8FAFC] min-h-screen">
    <nav class="bg-white border-b px-10 py-5 flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-xl font-bold text-blue-600">GradSystem <span class="text-slate-400">| Tutor Analysis</span></h1>
        <button onclick="window.history.back()" class="text-xs font-bold text-slate-400 hover:text-blue-600">Back to Dashboard</button>
    </nav>

    <main class="max-w-7xl mx-auto p-10 grid grid-cols-1 lg:grid-cols-2 gap-12">
        <div class="bg-white p-6 rounded-[3rem] shadow-xl border border-slate-100">
            <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6 px-2">Diagnostic Overlay</h3>
            <div class="relative rounded-[2.5rem] overflow-hidden bg-slate-50 border shadow-inner">
                <img id="studentImg" src="" class="w-full">
                <div id="h-top" class="heatmap-zone top-0"><span class="density-pill" id="t-text">--%</span></div>
                <div id="h-mid" class="heatmap-zone top-1/3"><span class="density-pill" id="m-text">--%</span></div>
                <div id="h-bot" class="heatmap-zone top-2/3"><span class="density-pill" id="b-text">--%</span></div>
            </div>
        </div>

        <div class="space-y-8">
            <div class="bg-white p-10 rounded-[3rem] shadow-xl border border-slate-100">
                <div class="flex justify-between items-start mb-10">
                    <div><p class="text-[10px] font-black text-blue-500 uppercase">AI Grade</p><h2 class="text-8xl font-black text-slate-800" id="score">--</h2></div>
                    <div id="stars" class="text-3xl text-yellow-400"></div>
                </div>
                <div class="space-y-8 mb-12">
                    <div><div class="flex justify-between text-[10px] font-black text-slate-500 mb-2 uppercase"><span>Clarity</span><span id="c-val">0/10</span></div><div class="bg-slate-100 h-2 rounded-full overflow-hidden"><div id="c-bar" class="bg-blue-500 h-full transition-all duration-1000" style="width: 0%"></div></div></div>
                    <div><div class="flex justify-between text-[10px] font-black text-slate-500 mb-2 uppercase"><span>Technical Logic</span><span id="l-val">0/10</span></div><div class="bg-slate-100 h-2 rounded-full overflow-hidden"><div id="l-bar" class="bg-indigo-500 h-full transition-all duration-1000" style="width: 0%"></div></div></div>
                </div>
                <div class="bg-blue-600 p-8 rounded-3xl text-white shadow-lg"><h4 class="text-[10px] font-black uppercase opacity-80 mb-3">ðŸ¤– AI Tutor Recommendation</h4><p id="feedback" class="text-sm font-bold leading-relaxed"></p></div>
            </div>
        </div>
    </main>

    <script src="config.js"></script>
    <script>
        const subId = new URLSearchParams(window.location.search).get('id');
        db.collection('submissions').doc(subId).onSnapshot(doc => {
            if (!doc.exists) return;
            const d = doc.data(), ai = d.ai_full_json || {}, s = ai.scores || { clarity: 0, logic: 0 };
            document.getElementById('studentImg').src = d.image_url;
            document.getElementById('score').innerText = d.ai_score || "--";
            document.getElementById('stars').innerText = "â˜…".repeat(d.stars || 0);
            document.getElementById('feedback').innerText = d.ai_feedback || "Analyzing...";
            document.getElementById('c-val').innerText = `${s.clarity}/10`; document.getElementById('c-bar').style.width = `${s.clarity*10}%`;
            document.getElementById('l-val').innerText = `${s.logic}/10`; document.getElementById('l-bar').style.width = `${s.logic*10}%`;
            
            const render = (id, txt, val) => {
                const el = document.getElementById(id), t = document.getElementById(txt), n = parseInt(val) || 0;
                el.style.backgroundColor = n >= 8 ? '#22c55e' : (n >= 4 ? '#eab308' : '#ef4444');
                t.innerText = `${n*10}% Density`;
            };
            render('h-top', 't-text', ai.heatmap?.top); render('h-mid', 'm-text', ai.heatmap?.middle); render('h-bot', 'b-text', ai.heatmap?.bottom);
        });
    </script>
</body>
</html>